
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
        <title>严格次小生成树 | Yhs_JokerのBlog</title>
        <meta name="author" content="Yhs_Joker">
        <meta name="description" content="There is only one kind of heroism in the world, which is to love life after knowing the truth of life.">
        <meta name="keywords" content="">
        <link rel="icon" href="/img/images/head_portrait.jpg">
        <script src="https://cdn.staticfile.org/instant.page/5.1.0/instantpage.min.js" type="module"></script>
        <script src="https://cdn.staticfile.org/font-awesome/6.2.0/js/all.min.js"></script>
        
        <link rel="stylesheet" href="/css/fonts.min.css">
        <link rel="stylesheet" href="/css/particlex.css">
        
        <script src="https://cdn.staticfile.org/vue/3.2.33/vue.global.prod.min.js"></script>
    <meta name="generator" content="Hexo 6.3.0"></head>
    <body>
        <div id="loading" style="height:100vh;width:100vw;position:fixed;display:flex;z-index:200;justify-content:space-between;background:#fff;transition:opacity 0.3s ease-out"><div style="position:fixed;height:100vh;width:100vw;display:flex;justify-content:center;align-items:center"><div id="loadcontent" style="width:50vmin;height:50vmin;padding:50px;border-radius:50%;display:flex;justify-content:center;align-items:center;border:solid 10px #a3ddfb;text-align:center"><div><h2>LOADING...</h2><p style="word-break:keep-all">加载过慢请开启缓存(浏览器默认开启)</p><div><img alt="loading" src="/loading.gif"></div></div></div></div></div>
        <div id="layout">
            <i data-fa-symbol="calendar-solid" class="fa-solid fa-calendar fa-fw"></i>
            <i data-fa-symbol="bookmark-solid" class="fa-solid fa-bookmark fa-fw"></i>
            <i data-fa-symbol="tags-solid" class="fa-solid fa-tags fa-fw"></i>
            <transition name="into">
                <div v-show="show_page" style="display: -not-none">
                    <div id="menu_show">
                         
<nav id="menu">
    <div class="desktop-menu">
        <a href="/">
            <span class="title">Yhs_JokerのBlog</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;about</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;tags</span>
        </a>
        
    </div>
    <div :class="'phone-menu ' + menu_show" id="phone-menu">
        <div class="curtain" @click="menu_show = !menu_show" v-show="menu_show"></div>
        <div :class="'title'" @click="menu_show = !menu_show">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;Yhs_JokerのBlog</span>
        </div>
        <transition name="slide">
        <div class="items" v-show="menu_show">
            
            <a href="/">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-house fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">home</div>
                </div>
            </a>
            
            <a href="/about">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-id-card fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">about</div>
                </div>
            </a>
            
            <a href="/archives">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-box-archive fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">archives</div>
                </div>
            </a>
            
            <a href="/categories">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-bookmark fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">categories</div>
                </div>
            </a>
            
            <a href="/tags">
                <div class="item">
                    <div style="min-width: 20px; max-width: 50px; width: 10%">
                        <i class="fa-solid fa-tags fa-fw"></i>
                    </div>
                    <div style="min-width: 100px; max-width: 150%; width: 20%">tags</div>
                </div>
            </a>
            
        </div>
        </transition>
    </div>
</nav>
                    </div>
                    <div id="main">
                        
<div class="article">
    <div>
        <h1>严格次小生成树 </h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#calendar-solid"></use></svg>
            </span>
            2022/11/30
        </span>
        
        <span class="category">
            <a href="/categories/题解/">
                <span class="icon">
                    <svg class="fa-icon"><use xlink:href="#bookmark-solid"></use></svg>
                </span>
                题解
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <svg class="fa-icon"><use xlink:href="#tags-solid"></use></svg>
            </span>
            
            <span class="tag">
                
                <a href="/tags/洛谷/" style="color: #03a9f4">
                    洛谷
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/Kruskal重构树/" style="color: #ff7d73">
                    Kruskal重构树
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/倍增/" style="color: #ff7d73">
                    倍增
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/紫/" style="color: #00a596">
                    紫
                </a>
            </span>
            
        </span>
        
    </div>
    <div class="content" v-pre>
        <p>很综合的一道题目,代码较长,且细节比较多</p>
<span id="more"></span>

<h2 id="原题戳这里"><a href="#原题戳这里" class="headerlink" title="原题戳这里"></a><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4180">原题戳这里</a></h2><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>小 C 最近学了很多最小生成树的算法，Prim 算法、Kruskal 算法、消圈算法等等。正当小 C 洋洋得意之时，小 P 又来泼小 C 冷水了。小 P 说，让小 C 求出一个无向图的次小生成树，而且这个次小生成树还得是严格次小的,也就是说,严格次小生成树的边权值和要严格大于最小生成树的边权之和.</p>
<p>这下小 C 蒙了，他找到了你，希望你帮他解决这个问题。</p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行包含两个整数N和M,表示无向图的点数与边数。</p>
<p>接下来M行,每行3个数x,y,z表示，点x和点y之间有一条边，边的权值为z。</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>包含一行，仅一个数，表示严格次小生成树的边权和。</p>
<h2 id="输入输出样例"><a href="#输入输出样例" class="headerlink" title="输入输出样例"></a>输入输出样例</h2><h3 id="输入-1"><a href="#输入-1" class="headerlink" title="输入#1"></a>输入#1</h3><pre><code>5 6
1 2 1 
1 3 2 
2 4 3 
3 5 4 
3 4 3 
4 5 6 
</code></pre>
<h3 id="输出-1"><a href="#输出-1" class="headerlink" title="输出#1"></a>输出#1</h3><pre><code>11
</code></pre>
<h2 id="提示-x2F-说明"><a href="#提示-x2F-说明" class="headerlink" title="提示&#x2F;说明"></a>提示&#x2F;说明</h2><p>数据中无向图不保证无自环</p>
<p>对于100%的数据, N&lt;&#x3D;10^5, M&lt;&#x3D;3*10^5,0&lt;&#x3D;z&lt;&#x3D;10^9,数据保证必定存在严格次小生成树</p>
<hr>
<h2 id="题目大意"><a href="#题目大意" class="headerlink" title="题目大意"></a>题目大意</h2><p>找到严格次小生成树,输出它的边权和</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>首先需要知道,严格次小生成树和最小生成树有且仅有一条边不同,可以通过反证法证明</p>
<blockquote>
<p><strong>证明</strong>:<br>假设存在严格次小生成树S2,有k(k≥2)条边与最小生成树S1不同,则我们删去不同的这k条边,就会出现k+1个连通块,然后我们再选择k个部分用最小生成树中的边将它们连接成一个连通块,此时它显然与最小生成树只有一个边的差距,最后选择次小生成树的边将它们连接.此时,新连通的生成树S0会满足以下关系,S1&lt;S0&lt;S2,因此,与假设矛盾,证得严格次小生成树和最小生成树有且仅有一条边不同</p>
</blockquote>
<p>然后,我们需要做的就是在最小生成树外找到一条边,替换掉最小生成树中的一条边,令新的生成树为次严格最小生成树.</p>
<p>我们的做法就是枚举每一条不在最小生成树中的边e,权重为w,然后将它添加进最小生成树中.当我们在添加一条边e后,树的局部就会形成一个环,如果我们要想使新的生成树尽可能的小,我们就需要将环中非e的最大边e_max删除,得到的就是其中一个局部最优的生成树,然后我们将每个局部最优生成树进行比较,最终得到全局的次严格最小生成树.</p>
<p>由于要求的是次严格最小生成树,所以当删除环内最大边e_max时,如果其w_max&#x3D;&#x3D;w,则我们需要删除环内的严格次大边.</p>
<p>如何快速得到环内的最大边和严格次大边,我们可以使用倍增来维护</p>
<p>代码的整体流程就是:求出最小生成树,枚举不在树上的每一条边,从边上的两个顶点开始跑倍增算法,求出环上要删除的边,求得此生成树的大小,更新严格次小生成树</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><pre><code class="cpp">#include&lt;iostream&gt;
#include&lt;cstring&gt;
#include&lt;algorithm&gt;

using namespace std;
using ll=long long;

const int N=100010,M=300010,INF=0x3f3f3f3f;

int n,m;

struct edge
&#123;
    int u,v,w;
    bool st;    //储存此边是否在最小生成树中
    bool operator&lt;(edge r)
    &#123;
        return w&lt;r.w;
    &#125;
&#125;;

edge edg[M];    //储存全部边
int p[N];   //跑kruskal使用的并查集
int h[N],e[M],ne[M],w[M],idx;   //链式向前星储存最小生成树
int depth[N],fa[N][18],d1[N][18],d2[N][18]; 
//depth[i]:储存i节点深度 fa[j][k]:j节点向上第2^k个父节点 
//d1[j][k]:j节点向上2^k条边中的最大值 d2[j][k]:j节点向上2^k条边中的严格次大值

int q[N];   //跑bfs用的队列

int find(int x)
&#123;
    if(p[x]!=x) p[x]=find(p[x]);
    return p[x];
&#125;

ll kruskal()
&#123;
    for(int i=1;i&lt;=n;i++)
        p[i]=i;
    ll res=0;
    sort(edg,edg+m);
    for(int i=0;i&lt;m;i++)
    &#123;
        int a=find(edg[i].u),b=find(edg[i].v);
        if(a!=b)
        &#123;
            edg[i].st=1;
            res+=edg[i].w;
            p[a]=b;
        &#125;
    &#125;
    return res;
&#125;

void add(int a,int b,int c)
&#123;
    e[idx]=b;
    w[idx]=c;
    ne[idx]=h[a];
    h[a]=idx++;
&#125;

void build()
&#123;
    memset(h,-1,sizeof h);
    
    for(int i=0;i&lt;m;i++)
    &#123;
        if(edg[i].st)
        &#123;
            add(edg[i].u,edg[i].v,edg[i].w);
            add(edg[i].v,edg[i].u,edg[i].w);
        &#125;
    &#125;
&#125;

void bfs()
&#123;
    memset(depth,0x3f,sizeof depth);
    depth[1]=1;
    depth[0]=0;
    int hh=0,tt=0;
    q[0]=1;
    while(hh&lt;=tt)
    &#123;
        int u=q[hh++];
        for(int i=h[u];~i;i=ne[i])
        &#123;
            int j=e[i];
            if(depth[j]&gt;depth[u]+1)
            &#123;
                depth[j]=depth[u]+1;
                q[++tt]=j;
                fa[j][0]=u;
                d1[j][0]=w[i];
                d2[j][0]=-INF;  //次大值不存在时,设为-INF
                for(int k=1;k&lt;18;k++)
                &#123;
                    int anc=fa[j][k-1];

                    int distance[4]=&#123;d1[j][k-1],d1[anc][k-1],d2[j][k-1],d2[anc][k-1]&#125;;  
                    //整段的最大值和次大值只能在两个小段的最大值和次大值中出现

                    fa[j][k]=fa[anc][k-1];
                    int m1=-INF,m2=-INF;    //m1:储存最大值,m2:储存次大值
                    for(int t=0;t&lt;4;t++)
                    &#123;
                        int d=distance[t];
                        if(d&gt;m1) m2=m1,m1=d;
                        else if(d&lt;m1&amp;&amp;d&gt;m2) m2=d;
                    &#125;
                    d1[j][k]=m1,d2[j][k]=m2;
                &#125;
            &#125;
        &#125;
    &#125;
    
&#125;

int lca(int a,int b,int w)
&#123;
    int d[N*2],cnt=0;
    if(depth[a]&lt;depth[b]) swap(a,b);
    for(int k=17;k&gt;=0;k--)
    &#123;
        if(depth[fa[a][k]]&gt;=depth[b])
        &#123;
            d[cnt++]=d1[a][k];
            d[cnt++]=d2[a][k];
            a=fa[a][k];
        &#125;
    &#125;
    if(a!=b)
    &#123;
        for(int k=17;k&gt;=0;k--)
        &#123;
            if(fa[a][k]!=fa[b][k])
            &#123;
                d[cnt++]=d1[a][k];
                d[cnt++]=d2[a][k];
                d[cnt++]=d1[b][k];
                d[cnt++]=d2[b][k];
                a=fa[a][k];
                b=fa[b][k];
            &#125;
        &#125;
        d[cnt++]=d1[a][0];
        d[cnt++]=d2[a][0];
        d[cnt++]=d1[b][0];
        d[cnt++]=d2[b][0];
    &#125;
    int m1=-INF,m2=-INF;
    for(int i=0;i&lt;cnt;i++)
    &#123;
        int dd=d[i];
        if(dd&gt;m1) m2=m1,m1=dd;
        else if(dd&lt;m1&amp;&amp;dd&gt;m2) m2=dd;
    &#125;
    
    if(w&gt;m1) return w-m1;
    if(w&gt;m2) return w-m2;
    return INF;
&#125;

int main()
&#123;
    cin&gt;&gt;n&gt;&gt;m;
    for(int i=0;i&lt;m;i++)
    &#123;
        int a,b,c;
        cin&gt;&gt;a&gt;&gt;b&gt;&gt;c;
        edg[i]=&#123;a,b,c&#125;;
    &#125;
    ll sum=kruskal();
    build();
    bfs();
    ll res=1e18;
    for(int i=0;i&lt;m;i++)
    &#123;
        if(!edg[i].st)
        &#123;
            int t=lca(edg[i].u,edg[i].v,edg[i].w);
            res=min(res,sum+t);
        &#125;
    &#125;
    cout&lt;&lt;res;
&#125;
</code></pre>

    </div>
    
    
</div>
                         
<footer id="footer">
    <div class="footer-wrap">
        <div>
            © 2022 - 2023 Yhs_JokerのBlog
            <span class="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            @Yhs_Joker
        </div>
        <div></div>
        <div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo Engine</a> & <a
                target="_blank" rel="noopener" href="https://github.com/argvchs/hexo-theme-particlex">ParticleX Theme</a></div>
        
    </div>
</footer>
                    </div>
                </div>
            </transition>
            <div id="img_show">
                <img id="img_content" alt="img_show">
            </div>
        </div>
        <script src="https://cdn.staticfile.org/highlight.js/11.5.1/highlight.min.js"></script>
        <script src="/js/particlex.js"></script>
        <script src="/js/showimg.js"></script>
        

    </body>
</html>